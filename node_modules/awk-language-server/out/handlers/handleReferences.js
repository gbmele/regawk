"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getReferencesHandler = void 0;
const node_1 = require("vscode-languageserver/node");
const utils_1 = require("../utils");
function getReferencesHandler(context) {
    const { trees, namespaces, dependencies } = context;
    return function handleReferences(params) {
        const { textDocument, position } = params;
        const node = utils_1.getNodeAt(trees[textDocument.uri], position.line, position.character);
        if (!node)
            return [];
        const parentFunc = utils_1.getParentFunction(node);
        if (parentFunc) {
            return utils_1.findReferences(parentFunc, namespaces[textDocument.uri], node, namespaces[textDocument.uri]).map((range) => node_1.Location.create(textDocument.uri, range));
        }
        const result = [];
        for (const uri of dependencies.getLinkedUris(textDocument.uri)) {
            if (!trees[uri])
                continue;
            result.push(...utils_1.findReferences(trees[uri].rootNode, namespaces[uri], node, namespaces[textDocument.uri]).map((range) => node_1.Location.create(uri, range)));
        }
        return result;
    };
}
exports.getReferencesHandler = getReferencesHandler;
//# sourceMappingURL=handleReferences.js.map
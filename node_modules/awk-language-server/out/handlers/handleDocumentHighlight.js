"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getDocumentHighlightHandler = void 0;
const node_1 = require("vscode-languageserver-protocol/node");
const utils_1 = require("../utils");
function getDocumentHighlightHandler(context) {
    const { trees, namespaces } = context;
    return function handleDocumentHighlight(params) {
        var _a;
        const { textDocument, position } = params;
        const { uri } = textDocument;
        let node = utils_1.getNodeAt(trees[textDocument.uri], position.line, position.character);
        if (!node)
            return [];
        if (node.type === 'number' && ((_a = node.parent) === null || _a === void 0 ? void 0 : _a.type) === 'field_ref') {
            node = node.parent;
        }
        const tree = trees[textDocument.uri];
        return utils_1.findReferences(tree.rootNode, namespaces[uri], node, namespaces[uri]).map((range) => node_1.DocumentHighlight.create(range));
    };
}
exports.getDocumentHighlightHandler = getDocumentHighlightHandler;
//# sourceMappingURL=handleDocumentHighlight.js.map
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getDefinitionHandler = void 0;
const utils_1 = require("../utils");
function getDefinitionHandler(context) {
    const { trees, symbols, namespaces, dependencies } = context;
    return function handleDefinition(params) {
        const { textDocument, position } = params;
        const node = utils_1.getNodeAt(trees[textDocument.uri], position.line, position.character);
        if (!node)
            return [];
        const name = utils_1.getName(node);
        if (!name)
            return [];
        const namespace = utils_1.getNamespace(node, namespaces[textDocument.uri]);
        const parentFunc = utils_1.getParentFunctionName(node);
        const containerName = parentFunc ? `${namespace}::${parentFunc}` : namespace;
        return [...dependencies.getLinkedUris(textDocument.uri)]
            .filter((uri) => { var _a; return (_a = symbols[uri]) === null || _a === void 0 ? void 0 : _a.has(name); })
            .filter((uri) => namespace === 'awk' || namespaces[uri].has(namespace))
            .flatMap((uri) => symbols[uri]
            .get(name)
            .filter((s) => s.containerName === containerName)
            .map((s) => s.location));
    };
}
exports.getDefinitionHandler = getDefinitionHandler;
//# sourceMappingURL=handleDefinition.js.map